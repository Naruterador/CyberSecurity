## 木马相关案例
- 2022年6月29日，中国的多家科研机构发现了名为“验证器”的木马程序。根据360公司的研究报告，这个木马是美国国家安全局（NSA）开发的，可远程部署或手动部署在任何Windows系统上。它能24小时在线运行，使NSA的操作者和数据窃密者可以上传下载文件、远程运行程序、获取系统信息、伪造ID，并能在特定情况下紧急自毁。
- 这个案例强调了网络安全在全球化时代的重要性，特别是在敏感和关键的信息基础设施领域。木马程序的使用不仅是技术问题，也涉及到更广泛的地缘政治和国家安全问题。

## 木马的由来
- 木马是“特洛伊木马”（trojan horse）的简称，据说这个名称来源于希腊神话《木马屠城记》。
- 如今黑客程序借用其名，有“一经潜入，后患无穷”之意。

## 木马的定义
- 在计算机系统中，“特洛伊木马”指系统中被植入的、人为设计的程序，目的包括通过网络远程控制其他用户的计算机系统，窃取信息资料，并可恶意致使计算机系统瘫痪。

## 木马的危害
- 根据传统的数据安全模型的分类，木马程序的企图可以对应分为三种：
  - 试图访问未授权资源
  - 试图阻止访问
  - 试图更改或破坏数据和系统

- 木马程序具有很大的危害性，主要表现在:
  -  自动搜索已中木马的计算机
  -  管理对方资源，如复制文件、删除文件、查看文件内容、上传文件、下载文件等
  -  跟踪监视对方屏幕
  -  直接控制对方的键盘、鼠标
  -  随意修改注册表和系统文件
  -  共享被控计算机的硬盘资源
  -  监视对方任务且可终止对方任务
  -  远程重启和关闭机器

## 木马的分类
- 从木马所实现的功能角度可分为：
  - 破坏型
    - 惟一的功能就是破坏并且删除文件，如电脑上的DLL、INI、EXE文件或其它类型文件，造成系统损坏，用户数据被破坏。
    - 功能简单，容易实现，破坏性强。
  - 密码发送型
    - 找到隐藏密码并把它们发送到指定的信箱。
    - 有人喜欢把自己的各种密码以文件的形式存放在计算机中，认为这样方便；还有人喜欢用WINDOWS提供的密码记忆功能，这样就可以不必每次都输入密码了。
    - 许多木马可以寻找到这些敏感信息，把它们送到黑客手中。
  - 远程访问型
    - 使用这类木马，只需有人运行了服务端程序，如果客户知道了服务端的IP地址，就可以实现远程控制。
    - 这类程序可以实现观察"受害者"正在干什么，当然这个程序完全可以用在正道上的，比如监视学生机的操作。
  - 键盘记录木马
    - 记录受害者的键盘敲击并且在日志文件里查找可能的密码。
    - 这种木马随着Windows的启动而启动。它们有在线和离线记录这样的选项，顾名思义，它们分别记录你在线和离线状态下敲击键盘时的按键情况。
    - 也就是说你按过什么按键，种植木马的人都知道，从这些按键中他很容易就会得到你的密码等有用信息!
    - 当然，对于这种类型的木马，邮件发送功能也是必不可少的。
  - DoS攻击木马
    - 随着DoS攻击越来越广泛的应用，被用作DoS攻击的木马也越来越流行起来。当你入侵了一台机器，给他种上DoS攻击木马，那么日后这台计算机就成为你DoS攻击的最得力助手了。
    - 这种木马的危害不是体现在被感染计算机上，而是体现在攻击者可以利用它来攻击一台又一台计算机，给网络造成很大的伤害和带来损失。
    - 还有一种类似DoS的木马叫做邮件炸弹木马，一旦机器被感染，木马就会随机生成各种各样主题的信件，对特定的邮箱不停地发送邮件，一直到对方瘫痪、不能接受邮件时为止。
  - 代理木马
    - 黑客在入侵的同时掩盖自己的足迹，谨防别人发现自己的身份是非常重要的。因此，给被控制的“肉鸡”种上代理木马，让其变成攻击者发动攻击的跳板，就是代理木马最重要的任务。
    - 通过代理木马，攻击者可以在匿名的情况下使用Telnet、ICQ、IRC等程序，从而隐蔽自己的踪迹。
  - 程序杀手木马
    - 上面的木马功能虽然形形色色，不过到了对方机器上要发挥自己的作用，还要过防木马软件这一关才行。常见的防木马软件有ZoneAlarm、Norton Anti-Virus等。
    - 程序杀手木马的功能就是关闭对方机器上运行的这类程序，让其他的木马更好地发挥作用
  - 反弹端口型木马
    - 木马开发者在分析了防火墙的特性后发现:防火墙对于连入的链接往往会进行非常严格的过滤，但是对于连出的链接却疏于防范。
    - 于是，与一般的普通木马相反，反弹端口型木马的服务端 (被控制端)使用主动端口，客户端 (控制端)使用被动端口。
    - 反弹窗口木马定时监测控制端的存在，发现控制端上线，立即弹出端口主动连结控制端打开的被动端口；为了隐蔽起见，控制端的被动端口一般开在80，即使用户使用扫描软件检查自己的端口，发现类似 TCP UserIP:1026 ControllerIP:80 ESTABLISHED 的情况，稍微疏忽一点，你就会以为是自己在浏览网页。



## 木马实现原理
- 本质上说，木马大多都是网络客户/服务（Client/Server） 程序的组合。
- 常由一个攻击者控制的客户端程序和一个运行在被控计算机端的服务端程序组成。
- 当攻击者要利用“木马”进行网络入侵，一般都需完成如下环节：
  - 向目标主机植入木马
    - 木马植入技术可以大概分为主动植入与被动植入两类。
      - 所谓主动植入，就是攻击者主动将木马程序种到本地或者是远程主机上，这个行为过程完全由攻击者主动掌握。
      - 而被动植入，是指攻击者预先设置某种环境，然后被动等待目标系统用户的某种可能的操作，只有这种操作执行，木马程序才有可能植入目标系统。
  - 启动木马
    - 在Windows系统中木马程序的自动加载技术主要有：
     - 修改系统文件
     -  修改系统注册表
     -  添加系统服务
     -  修改文件打开关联属性
     -  修改任务计划
     -  修改组策略
     -  利用系统自动运行的程序
     -  修改启动文件夹
     -  替换系统DLL
  - 隐藏木马
    - 想要隐藏木马的服务端，可以是伪隐藏，也可以是真隐藏。
    - 隐藏是指程序的进程仍然存在，只不过是让它消失在进程列表里。
    - 真隐藏则是让程序彻底的消失，不以一个进程或者服务的方式工作。
  - 服务器端（目标主机）和客户端建立连接
    - 在网络客户端/服务器工作模式中，必须具有一台主机提供服务（服务器），另一台主机接受服务（客户端），这是最起码的硬件必需，也是“木马”入侵的基础。
    - 建立连接时，木马的服务端会在目标主机上打开一个默认的端口进行侦听（Listen），如果有客户机向服务器的这一端口提出连接请求（Connect Request），服务器上的相关程序（木马服务器端）就会自动运行，并启动一个守护进程来应答客户机的各种请求。
  - 进行远程控
    - 木马程序的远程操作功能如远程关机、重启，鼠标与键盘的控制，远程的文件管理等等。
    - 木马程序有时需要重新启动被控制端计算机，或者强制关闭远程计算机，当被控制计算机重新启动时，木马程序重新获得控制权。
    - 在木马程序中，木马使用者还可以通过网络控制被控端计算机的鼠标和键盘，也可以通过这种方式启动或停止被控端的应用程序。
    - 对远程的文件进行管理，比如共享被控端的硬盘，之后就可以进行任意的文件操作。

## 木马的特点
- 一个典型的特洛伊木马（程序）通常具有以下四个特点：
  - 有效性
    - 由于木马常常构成网络入侵方法中的一个重要内容，它运行在目标机器上就必须能够实现入侵者的某些企图。
    - 因此有效性就是指入侵的木马能够与其控制端（入侵者）建立某种有效联系，从而能够充分控制目标机器并窃取其中的敏感信息。
    - 因此有效性是木马的一个最重要特点。
  - 隐蔽性
    - 木马必须有能力长期潜伏于目标机器中而不被发现。
    - 一个隐蔽性差的木马往往会很容易暴露自己，进而被杀毒（或杀马）软件，甚至用户手工检查出来，这样将使得这类木马变得毫无价值。
    - 因此可以说隐蔽性是木马的生命。
  - 顽固性
    - 当木马被检查出来（失去隐蔽性）之后，为继续确保其入侵有效性，木马往往还具有另一个重要特性——顽固性。
    - 木马顽固性就是指有效清除木马的难易程度。若一个木马在检查出来之后，仍然无法将其一次性有效清除，那么该木马就具有较强的顽固性。
  - 易植入性
    - 任何木马必须首先能够进入目标机器，因此易植入性就成为木马有效性的先决条件。
    - 欺骗是自木马诞生起最常见的植入手段，因此各种好用的小功能软件就成为木马常用的栖息地。
    - 利用系统漏洞进行木马植入也是木马入侵的一类重要途径。
    - 目前木马技术与蠕虫技术的结合使得木马具有类似蠕虫的传播性，这也就极大提高了木马的易植入性。

## 木马的特点
- 此外，木马还具有以下辅助型特点：
  - 自动运行
    - 通常木马程序通过修改系统的配置文件或注册表文件，在目标系统启动时就自动加载运行。
    - 这种自动加载运行不需要客户端干预，同时也不会被目标系统用户所觉察。
  - 欺骗性
    - 木马程序要达到其长期隐蔽的目的，就必需采取各种各样的欺骗手段，欺骗目标系统用户，以防被发现。
    - 比如木马程序经常会采用一种文件名的欺骗手段，如exploer这样的文件名，以此来与系统中的合法程序explorer相混淆。
    -  木马的编制者还在不断制造新的欺骗的手段，花样层出不穷，让人防不胜防。
  - 自动恢复
    - 现在很多木马程序中的功能模块已不再是由单一的文件组成，而是具有多重备份，可以相互恢复。
    - 计算机一旦感染上这种木马程序，想单独靠删除某个文件来清除是不太可能的。
  - 功能的特殊性
    - 通常木马的功能都是十分特殊的，除了普通的文件操作以外，有些木马具有搜索并发送目标主机中的口令、记录用户事件、进行键盘记录、远程注册表操作以及锁定鼠标等功能。

## 病毒木马分析网站
- https://www.virustotal.com/gui/



