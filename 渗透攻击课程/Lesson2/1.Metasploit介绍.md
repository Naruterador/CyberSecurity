## 诞生与发展
- Metasploit 是一个开源的渗透测试框架软件，也是一个逐步发展成熟的漏洞研究与渗透代码开发平台，此外也将成为支特整个渗透测试过程的安全技术集成开发与应用环境。
- Metasploit 项目最初由 HD Moore 在 2003 年夏季创立，目标是成为渗透攻击研究与代码开发的一个开放资源。当时 HD 还是 Digital Defense 安全公司雇员，当他意识到他的绝大多数时间是在用来验证和处理那些公开发布的渗透代码时，他开始为编写和开发滲透代码构建一个灵活且可维护的框架平台，并在2003 年的 10月发布了他的第一个基于 Perl 语言的Metasploit 版本，当时一共集成了 11 个渗透攻击模块。
## 渗透测试框架软件
- Metasploit 项目由著名黑客HD Moore 千2003 年开始开发，最早作为一个渗透攻击代码的集成软件包而发布。渗透攻击也是日前Metasploit 最强大和最具吸引力的核心功能，Metasploit 框架中集成了数百个针对主流操作系统平台上，不同网络服务与应用软件安全漏洞的渗透攻击模块，可以由用户在渗透攻击场景中根据漏洞扫描结果进行选择，并能够自由装配该平台上适用的具有指定功能的攻击载荷，然后通过自动化编码机制绕过攻击限制与检测措施，对目标系统实施远程攻击，获取系统的访问控制权。
- Metasploit 的出现使得一些渗透测试的初学者也能够像在黑客电影中演的那样“优雅潇洒〞地进行渗透攻击，告别了之前令人崩溃与望而却步的繁杂过程：
  - 搜索公开渗透代码一编译一测试一修改代码一实施一失败一不断调试直至成功
正因为如此，Metasploit 在发布之后很快得到了安全社区的青睐，成为黑客们与安全职业人员必备的渗透测试工具之一。
- 除了渗透攻击之外，Metasploit 在发展过程中逐渐增加对渗透测试全过程的支持，包括情报搜集、威胁建模、漏洞分析、后渗透攻击与报告生成。
  - 情报搜集阶段
    - Metasploit 一方面通过内建的一系列扫描探测与查点辅助模块来获取远程服务信息，另一方面通过插件机制集成调用 Nmap、Nessus、 OpenVAs 等业界著名的开源网络扫描工具，从而具备全面的信息搜集能力，为渗透攻击实施提供必不可少的精确情报。
  - 威胁建模阶段
    - 在搜集信息之后，Metasploit 支持一系列数据库命令操作直接将这些信息汇总至PostgreSQL、MysQL 或 sQLite 数据库中，并为用户提供易用的数据库查询命令，可以帮助渗透测试者对目标系统搜集到的情报进行威胁建模，从中找出最可行的攻击路径。
  - 漏洞分析阶段
    - 除了信息搜集环节能够直接扫描出一些已公布的安全漏洞之外，Metasploit 中还提供了大量的协议 FuzZ测试器与 Web 应用漏洞探测分析模块，支持具有一定水平能力的渗透测试者在实际过程中尝试挖掘出“零日”漏洞，并对漏洞机理与利用方法进行深人分析，而这将为渗透攻击目标带来更大的杀伤力，并提升渗透测试流程的技术含金量。
  - 后渗透攻击阶段
    - 在成功实施渗透攻击并获得目标系统的远程控制权之后，Metasploit 框架中另一个极具威名的工具 Meterpreter 在后渗透攻击阶段提供了强大功能。
    - Meterpreter 可以看做一个支持多操作系统平台，可以仅仅驻留于内存中并具备免杀能力的高级后门工具，Meterpreter 中实现了特权提升、信息攫取、系统监控、跳板攻击与内网拓展等多样化的功能特性，此外还支持一种灵活可扩展的方式来加载额外功能的后渗透攻击模块，足以支持渗透测试者在目标网络中取得立足点之后进行进一步的拓展攻击，并取得具有业务影响力的渗透效果。
  - 报告生成阶段
    - Metasploit 框架获得的渗透测试结果可以输人至内置数据库中，因此这些结果可以通过数据库查询来获取，并辅助渗透测试报告的写作。
    - 而商业版本的Metasploit Pro 具备了更加强大的报告自动生成功能，可以输出 HTML、XML、Word 和 PDF 格式的报告，并支持定制渗透测试报告模板，以及支持遵循 PCI DSS（银行支付行业数据安全标准）与FIMSA(美国联邦信息安全管理法案）等标准的合规性报告输出。
    - 正是由于Metasploit 最新版本具有支持渗透测试过程各个环节的如此众多且强大的功能特性，Metasploit 已经成为安全业界最受关注与喜爱的渗透测试流程支持软件。

## Metasploit面向群体
- Metasploit 软件的用户群体也首先面向职业的渗透测试工程师，以及非职业地从事一些滲透测试学习与实践的安全技术爱好者。Metasploit 或许是绝大多数渗透测试者最明智的渗透测试工具首选。
- 真正处于防御一线的网络与系统管理员们也应该熟悉和深人掌握 Metasploit，能够自主地对所管理的信息网络进行例行性的白盒式渗透测试，这将有效发现其中的安全薄弱点，在由于真正的人侵发生导致自己挨训甚至丟掉饭碗之前，能够做出有效的补救与防护措施。此外，Metasploit 还可以被软件、设备和安全产品测试人员们所使用，特别是在他们工作范围内的某款软件或设备被爆出公开利用的零日安全漏洞时，可以利用 Metasploit 来重现渗透攻击过程，定位安全漏洞并分析机理，从而修补软件与设备，而诸如IDS、IPS、杀毒软件等安全产品的测试人员，也可以使用 Metasploit 来检验产品的检测性能，以及针对Metasploit 强大免杀与逃逸技术的对抗能力。

## Metasploit框架体系介绍
  - Metasploit 是一个免费的、可下载的框架。通过它，网络安全人员可以很容易地获取、挖掘计算机软件漏洞，并对其实施攻击。Metasploit框架可以用来发现漏洞、利用漏洞、提交漏洞，并实施攻击。而且，用户可以从其他漏洞扫描程序导入数据，基于漏洞主机的详细信息来发现可攻击漏洞，从而使用有效载荷对系统发起攻击。Metasploit框架的强大之处就是提供了大量的渗透测试模块和插件。这些模块按照不同用途可以分为7种类型:
    - Exploits（渗透攻击模块）
      - 渗透攻击模块主要利用发现的安全漏洞或配置弱点对目标系统进行攻击，以植入和运行攻击载荷，从而获得目标系统的访问控制权。Metasploit 框架中的渗透攻击模块可以按照安全漏洞所在的位置，分为主动渗透攻击与被动渗透攻古两大类。其中，这两种攻击类型的区别如下所述。
        - 主动渗透攻击：利用的安全漏洞位于网络服务端软件与服务端软件承载的上层应用程序之中。由于这些服务通常是在主机上开启一些监听端口，并等待客户端连接。通过连接目标系统网络服务，注入一些特殊构造的包含 “恶意” 攻击数据的网络请求内容，触发安全漏洞，并使得远程服务器执行 “恶意” 数据中包含的攻击荷花，从而获取目标系统的控制权限。
        - 被动渗透攻击：利用的漏洞位于客户端软件（如浏览器、浏览器插件、电子邮件容户端、office 与Adobe 等各种文档与编辑软件）。对于这类安全漏洞，滲透测试者无法主动地将数据从远程输入到客户端软件中，因此只能采用被动渗透攻击方式通常使用的被动渗透攻击方式有构造 “恶意〞的网页、电子邮件或文档文件，并通过架设包含此类恶意内容的服务端、发送邮件附件、结合社会工程学攻击分发、结合网络欺骗和劫持技术等，诱骗目标用户打开或访问目标系统上的这些恶意内容，从而触发客户端软件中的安全漏洞，以获取控制目标系统的Shell会话。
    - Auxiliary（辅助模块）
        - 辅助模块包括针对各种网络服务的扫描与检测，构建虛假服务收集登录密码、口令猜测等模块。另外，辅助模块中还包括一些无须加载的攻击载荷，这些模块不用来取得目标系统远程控制权，如拒绝服务攻击。
    - Post（后渗透攻击模块）
       - 后渗透攻击模块：后渗透攻击模块主要用于取得目标系统远程控制权之后的环节，实现在受控制系统中进行各种各样的后渗透攻击动作，如获取敏感信息、进一步拓展、实施跳板攻击等。
    - Pavloads（攻击载荷模块）
       - 攻击载荷是在渗透攻击成功后促使目标系统运行的一段植入代码。通常作用是为渗透攻击者打开在目标系统上的控制会话连接。在传统的渗透代码开发中，攻击载荷只是一段简单的 Shellcode 代码，以汇编语言编制并转换为目标系统CPU体系结构支持的机器代码。在渗透攻击触发漏洞后，将程序执行流程劫持并跳转入这段代码中执行，从而完成ShellCode中的单一功能。Metasploit攻击载荷分为3种：
         - Single：是一种完全独立的 Payload，而且使用起来就像运行cale.exe一样简单，如添加一个系统用户或删除一份文件。由于single Payload 是完全独立的，因此它们有可能会被类似netcat这样的非 Metasploit处理工具所捕获。
         - Staeer：这种Payload 负责建立目标用户与攻击者之间的网络连接，并下载额外的组件或应用程序。一种常见的Stager Payload就是reverse_tcp，它可以让目标系统与攻击者建立一条TCP连接，让目标系统主动连找渗透测试者的端口（反向连接）。另一种常见的是 bind tcp，它可以让目标系统开启一个TCP监听器，而攻击者随时可以与目标系统进行通信(正向连接)
         - Stage:是Stager Payload 下的一种Payload 组件，这种 Payload 可以提供更加高级的功能，而且没有大小限制。
         - 有关两个常用载荷的说明:
           - 正向连接（bind_tcp）
            - 攻击机主动连接目标机，常用于目标不出网的情况
              - 正向连接指被攻击的目标机器通过正向的payload打开一个端口，攻击者的机器去连接目标机器的这个端口，从而建立连接如果把攻击机器比喻成你，目标机器比喻成妹子，正向连接相当于你去追妹子，最后建立了连接，两者可以互相通信
              - 使用场景
                - 如果⽬标处于深层⽹络，不能直接连通外⽹，也不能通过其他机器连通则可以使用正向，相当于妹子在家里宅着天天不出门，你为了追到手，只有去他家拜访一下
           - 反向连接（reverse_tcp）
              - 反向指攻击者的机器打开一个端口，目标机器运行反向payload来连接攻击机器的端口，从而建立连接。用上面的比喻，反向连接相当于妹子来追你，最后建立了连接，相互通信
              - 使用场景
                - 目标机主动连接攻击机，常用于机器出网的情况
    - Encoders （编码器模块）
      - 攻击载荷与空指令模块组装完成一个指令序列后，在这段指令被渗透攻击模块加入恶意数据缓冲区交由目标系统运行之前，Metasploit框架还需要进行编码。编码模块的主要作用有两个：
        - 第一，是确保攻击载荷中不会出现“坏字符”；
        - 第二，是对攻击载荷进行“免杀”处理，即躲避反病毒软件、IDS入侵检测系统和IPS入侵防御系统的检测与拦截。
    - Nops（空指令模块）
      - 空指令 (NOP)是一些对程序运行状态不会造成任何实质影响的空操作或无关操作指令，最典型的空指令就是空操作，在X86 CPU 体系结构平台上的操作码是0x90。在渗透攻击构造恶意数据缓冲区时，常常要在真正要执行的 Shellcode 之前添加一段空指令区。这样，当触发渗透攻击后跳转执行 ShellCode 时，会有一个较大的安全着陆区，从而避免受到内存地址随机化及返回地址计算偏差等原因造成的 ShellCode 执行失败，提供滲透攻击的可靠性。
    - Evasion（规避模块）
      - 规避模块是在Metasploit 5 中新增加的。用户可以使用规避模块来规避 Windows Defender防火墙。Windows Defender 现在是 Windows 系统自带的防火墙工具。它不仅可以扫描系统，还可以对系统进行实时监控。
    - 插件(plugins)
      - 插件能够扩充框架的功能，或者封装已有功能构成高级功能的组件。插件可以用于集成现有的一些外部安全工具，如 Nessus、OpenVAS 漏洞扫描器
