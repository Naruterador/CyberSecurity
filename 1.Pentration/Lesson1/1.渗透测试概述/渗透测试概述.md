## 什么是渗透测试
- 滲透测试是通过模拟恶意黑客的攻击方法，来评估计算机网络系统安全的一种安全测试与评估方法。通过实施渗透测试，可以发现一个主机中潜在却未被披露的安全性问题。然后，用户可以根据测试结果对系统中的不足和安全弱点进行加固及改善，从而使用户的系统变得更加安全，减少其风险。当用户实施渗透测试时，可以使用黑盒测试、白盒测试和灰盒测试3种方式。

## 渗透测试的起源与定义
- 各国军队每年都会组织一些军事演习来锻炼军队的攻防战术与作战能力。在信息科技的发源地——美国的军事演习中，将美军称为“蓝军”，将假想敌称为 “红军”，而这种军事演习的方式也在20 世纪 90 年代时，由美国军方与国家安全局引人到对信息网络与信息安全基础设施的实际攻防测试过程中。由一群受过职业训练的安全专家作为“红队”（Red Team)，对接受测试的防御方 “蓝队”(Blue Team）进行攻击，以实战的方式来检验目标系统安全防御体系与安全响应计划的有效性。为此，美军和园家安全局等情报部门专门组建了一些职业化的“红队”（也称为 Tiger Team)，比如著名的美国国家安全局 Red Cell 团队、美国海军计算机网络红队等。
- 这种通过实际的攻击进行安全测试与评估的方法就是渗透测试 (Penetration Testing,Pentest)。在20世纪90年代后期逐步开始从军队与情报部门拓展到安全业界。一些对安全性需求很高的企业开始采纳这种方式来对他们自己的业务网络与系统进行测试，而渗透测试也逐渐发展为一种由安全公司所提供的专业化安全评估服务。-
- 简而言之，渗透测试就是一种通过模拟恶意攻击者的技术与方法，挫败目标系统安全控制措施，取得访问控制权，并发现具备业务影响后果安全隐患的一种安全测试与评估方式。
- 滲透测试过程一般需要对目标系统进行主动探测分析，以发现潜在的系统漏洞，包括不恰当的系统配置，已知或未知的软硬件漏洞，以及在安全计划与响应过程中的操作性弱点等。而这一过程需要以攻击者的角度进行实施，通常涉及对大量发现安全漏洞的主动渗透与人侵攻击。渗透测试中发现的所有安全问题，它们所带来的业务影响后果评估，以及如何避免这些问题的技术解决方案，将在最终报告中呈现给目标系统的拥有者，帮助他们修补并提升系统的安全性。
- 渗透测试目前已经成为系统整体安全评估中的一个组件部分，例如银行支付行业数据安全标准(PCI DSS)等都将渗透测试作为必须进行的安全测试形式。
- 作为一种对抗性和定制要求都非常高的服务，渗透测试的完成质量依赖于实施人员即渗透测试者（Penetration Tester, Pentester）的技术能力、专业素养以及团队协作能力。提供渗透测试服务的安全公司或组织都需要由职业化渗透测试者组成的专业团队，这些滲透测试者一般被称为渗透测试工程师。

## 渗透测试分类
### 黑盒测试
- 黑盒测试（Black-box Testing）也称为外部测试 (External Testing)。采用这种方式时，滲透测试者将从一个远程网络位置来评估目标网络基础设施，并没有任何目标网络内部拓扑等相关信息。他们完全模拟真实网络环境中的外部攻击者，采用流行的攻击技术与工具，有组织、有步聚地对目标组织进行逐步渗透和入侵，揭示目标网络中一些已知或末知的安全漏洞，并评估这些漏洞能否被利用，以荻取控制权或者操作业务造成资产损失等。黑盒测试的缺点是测试较为费时和费力，同时需要渗透测试者具备较高的技术能力。而优点在于，这种类型的测试更有利于挖掘出系统潜在的漏洞，以及脆弱环节和薄弱点等。
### 白盒测试
- 白盒测试（White-box Testing）也称为内部测试 (Internal Testing）。进行白盒测试的渗透测试者可以了解到关于目标环境的所有内部和底层信息。这可以让滲透测试人员以最小的代价发现和验证系统中最严重的漏洞。白盒测试的实施流程与黑盒测试类似，不同之处在于无须进行目标定位和情报收集。渗透测试人员可以通过正常渠道从被测试机构取得各种资料，如网络拓扑、员工资料甚至网站程序的代码片段等，也可以和单位其他员工进行面对面沟通。白盒测试的缺点是无法有效地测试客户组织的应急响应程序，也无法判断出他们的安全防护计划对特定攻击的检测效率。这种测试的优点是发现和解决安全漏洞所花费的时间和代价要比黑盒测试少很多。
### 灰盒测试
- 灰盒测试（Grey-box Testing）是白盒测试和黑盒测试基本类型的组合，它可以提供对目标系统更加深入和全面的安全审查。组合之后的好处就是能够同时发挥这两种滲透测试方法的优势。在采用灰盒测试方法的外部渗透攻击场景中，渗透测试者也类似地需要从外部逐步渗透进目标网络，但他所拥有的目标网络底层拓扑与架构将有助于更好地选择攻击途径与方法，从而达到更好的渗透测试效果。

## 渗透测试方法与流程
- 目前，安全业界比较流行的开源渗透测试方法体系标准包括以下几个:
  - 安全测试方法学开源手册:
    - 由ISECOM 安全与公开方法学研究所制定，最新版本为2010年发布的v3.0。安全测试方法学开源手册 （OSSTMM）提供物理安全、人类心理学、数据网络、无线通信媒介和电讯通信这五类渠道非常细致的测试用例，同时给出评估安全测试结果的指标标准。OSSTMM 的特色在于非常注重技术的细节，这使其成为一个具有很好可操作性的方法指南。
  - NIST SP 800-42 网络安全测试指南
    - 美国国家标准与技术研究院(NIST）在SP 800-42 网络安全测试指南中讨论了渗透测试流程与方法，虽然不及 OSSTMM 全面，但是它更可能被管理部门所接受。
  - OWASP十大Web 应用安全威胁项目
    - 针对目前最普遍的 Web 应用层，为安全测试人员和开发者提供了如何识别与避免这些安全威胁的指南。OWASP十大web 应用安全威胁项目 (OWASP Top Ten）只关注具有最高风险的 Web 领域，而不是一个普适性的渗透测试方法指南。
  - Web 安全威胁分类标准
    - 与OWASP Top Ten 类似，web 应用安全威胁分类标准 (WASC-IC） 全面地给出目前Web 应用领域中的漏洞、攻击与防范措施视图。
  - PTES 渗透测试执行标准
    - 2010 年最新发起的渗透测试过程规范标准项目，核心理念是通过建立起进行滲透测试所要求的基本准则基线，来定义一次真正的渗透测试过程，并得到安全业界的广泛认同。通过深人了解这些开放的渗透测试方法标准，将有助于你对渗透测试建立起一个整体的知识与技能体系，所有这些方法标准背后的基本想法就是你的渗透测试过程应该按步骤实施，从而确保更加精确地评价一个系统的安全性。我们无法在这里细致地介绍每一个标准的细节，只是简要地介绍最新的 PTES 标准中定义的渗透测试过程环节。当你更加深人地了解渗透测试技术之后，可以更进一步去了解这些渗透测试方法体系，并在实际的渗透测试实践中加以应用。

## 渗透测试流程
- PTES 渗透测试执行标准是由安全业界多家领军企业技术专家所共同发起的，期望为企业组织与安全服务提供商设计并制定用来实施渗透测试的通用描述准则。PTES 标准项目网站为 http://www.pentest-standard.org/，从2010年11月开始（目前还处于开发阶段），目前己经发布了 BETA RELEASE 版本。
- PTES 标准中定义的渗透测试过程环节基本上反映了安全业界的普遍认同，具体包括以下7个阶段:
  - 前期交互阶段
    - 在前期交互 （Pre-Engagement Interaction）阶段，渗透测试团队与客户组织进行交互讨论，最重要的是确定渗透测试的范围、目标、限制条件以及服务合同细节。
    - 该阶段通常涉区收集客户需求、准备测试计划、定义测试范围与边界、定义业务目标、项目管理与规划等活动。
  - 情报搜集阶段
    - 在目标范围确定之后，将进人情报搜集 (Information Gathering） 阶段，渗透测试团队可以利用各种信息来源与搜集技术方法，尝试获取更多关于目标组织网络拓扑、系统配置与安全防御措施的信息。
    - 渗透测试者可以使用的情报搜集方法包括公开来源信息查询、Google Hacking、社会工程学、网络踩点、扫描探测、被动监听、服务查点等。而对目标系统的情报探查能力是渗透测试者一项非常重要的技能，情报搜集是否充分在很大程度上决定了渗透测试的成败，因为如果你遗漏关键的情报信息，你将可能在后面的阶段里一无所获。
  - 威胁建模阶段
    - 在搜集到充分的情报信息之后，渗透测试团队的成员们停下敲击键盘，大家聚到一起针对获取的信息进行威胁建模（Threat Modeling）与攻击规划。这是渗透测试过程中非常重要，但很容易被忽视的一个关键点。
    - 通过团队共同的镇密情报分析与攻击思路头脑风暴，可以从大量的信息情报中理清头绪，确定出最可行的攻击通道。
  - 漏洞分析阶段
    - 在确定出最可行的攻击通道之后，接下来需要考虑该如何取得日标系统的访问控制权，即漏洞分析 （Vulnerability Analysis）阶段。
    - 在该阶段，渗透测试者需要综合分析前几个阶段获取并汇总的情报信息，特别是安全漏洞扫描结果、服务查点信息等，通过搜索可获取的渗透代码资源，找出可以实施渗透攻击的攻击点，并在实验环境中进行验证。在该阶段，高水平的渗透测试团队还会针对攻击通道上的一些关键系统与服务进行安全漏洞探测与挖掘，期望找出可被利用的未知安全漏洞，并开发出渗透代码，从而打开攻击通道上的关键路径。
  - 渗透攻击阶段
    - 渗透攻击 （Exploitation）是渗透测试过程中最具有魅力的环节。在此环节中，滲透测试团队需要利用他们所找出的目标系统安全漏洞，来真正人侵系统当中，获得访问控制权。
    - 渗透攻击可以利用公开渠道可获取的渗透代码，但一般在实际应用场景中，渗透测试者还需要充分地考虑目标系统特性来定制渗透攻击，并需要挫败目标网络与系统中实施的安全防御措施，才能成功达成渗透目的。在黑盒测试中，渗透测试者还需要考虑对目标系统检测机制的逃逸，从而避免造成目标组织安全响应团队的警觉和发现。
  - 后渗透攻击阶段
    - 后渗透攻击 (Post Exploitation）是整个渗透测试过程中最能够体现渗透测试团队创造力与技术能力的环节。前面的环节可以说都是在按部就班地完成非常普遍的目标，而在这个环节中，需要渗透测试团队根据目标组织的业务经营模式、保护资产形式与安全防御计划的不同特点，自主设计出攻击目标，识别关键基础设施，并寻找客户组织最具价值和尝试安全保护的信息和资产，最终达成能够对客户组织造成最重要业务影响的攻击途径。
    - 在不同的渗透测试场景中，这些攻击目标与途径可能是千变万化的，而设置是否准确并且可行，也取决于团队自身的创新意识、知识范畴、实际经验和技术能力。
  - 报告阶段
    - 滲透测试过程最终向客户组织提交，取得认可并成功获得合同付款的就是一份渗透测试报告(Reporting)。这份报告凝聚了之前所有阶段之中渗透测试团队所获取的关键情报信息、探测和发掘出的系统安全漏洞、成功渗透攻击的过程，以及造成业务影响后果的攻击途径，同时还要站在防御者的角度上，帮助他们分析安全防御体系中的薄弱环节、存在的问题，以及修补与升级技术方案。